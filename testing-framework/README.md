# План тестирования: PulseVPN Manager v1.3

**Продукт:** PulseVPN Manager
**Версия:** 1.3 (Сборка 20250915)
**Автор:** Евгений Л
**Дата:** 15.09.2025

---

## 1. Область тестирования

Этот документ описывает стратегию тестирования для трех новых функциональных блоков:

1.  **Управление пулом ключей:** Гранулярный контроль над тем, какие серверы участвуют в автоматическом пополнении пула ключей.
2.  **Рефакторинг системы метрик:** Капитальная переработка системы сбора серверных метрик для использования API-эндпоинта на основе JSON.
3.  **Полировка UI:** Серия небольших корректировок пользовательского интерфейса для улучшения верстки и визуальной согласованности в представлении "Servers".

## 2. Тест-кейсы

Для проверки функциональности будут выполнены следующие тест-кейсы.

| ID | Функционал | Название | Шаги | Ожидаемый результат |
| :--- | :--- | :--- | :--- | :--- |
| **TC-POOL-01** | Пул ключей | Проверка отключения авто-пополнения для одного сервера | 1. Перейти в "Settings" -> "Key Pooling". <br> 2. Выключить переключатель для сервера "Germany". <br> 3. Вручную запустить цикл пополнения пула ключей. | `AutoKeyPoolManager` не должен назначать новые ключи для сервера "Germany". Количество ключей для этого сервера в пуле должно остаться неизменным. |
| **TC-METRICS-01** | Метрики | Проверка корректного отображения метрик для обновленного Outline-сервера (JSON) | 1. Перейти на вкладку "Servers". <br> 2. Наблюдать за карточкой Outline-сервера, на котором подтвержден запуск нового скрипта метрик на основе JSON. | Карточка сервера должна отображать "Live Metrics" с корректными значениями для CPU, Memory, Load и т.д. В консоли не должно быть ошибок. |
| **TC-METRICS-02** | Метрики | Проверка корректного отображения метрик для обновленного Shadowsocks-сервера (JSON) | 1. Перейти на вкладку "Servers". <br> 2. Наблюдать за карточкой Shadowsocks-сервера, на котором подтвержден запуск нового скрипта метрик на основе JSON. | Карточка сервера должна отображать "Live Metrics" с корректными значениями для CPU, Memory, Load и т.д. В консоли не должно быть ошибок. |
| **TC-METRICS-03** | Метрики | Проверка обратной совместимости с серверами без JSON API | 1. Перейти на вкладку "Servers". <br> 2. Наблюдать за карточкой сервера, на котором отсутствует эндпоинт метрик. | Приложение не должно падать. Карточка сервера должна отображать ошибку или резервное состояние (например, "Метрики недоступны"). В консоль должна быть записана ошибка подключения. |
| **TC-UI-01** | UI | Проверка динамического окрашивания значений метрик | 1. Перейти на вкладку "Servers". <br> 2. Наблюдать за сервером с высокой нагрузкой (CPU > 90%). | Числовое значение метрики CPU должно быть окрашено в красный цвет. |
| **TC-UI-02** | UI | Проверка отсутствия переноса текста в метриках | 1. Перейти на вкладку "Servers". <br> 2. Наблюдать за секцией "Live Metrics". | Заголовки "Conns" и "Docker" должны быть полностью видны на одной строке. |

---

# Отчеты о дефектах: PulseVPN Manager v1.3

**Продукт:** PulseVPN Manager
**Версия:** 1.3 (Сборка 20250915)
**Автор:** Евгений Л
**Дата:** 15.09.2025

---

### **Дефект: BUG-001 (Блокирующий)**

| Поле | Значение |
| :--- | :--- |
| **Название** | **[BLOCKER]** Все настроенные серверы исчезают из интерфейса после обновления приложения. |
| **Серьезность** | Blocker |
| **Приоритет** | Highest |
| **Окружение** | PulseVPN Manager v1.2 (Сборка Y) на macOS Sequoia 15.6.1, Xcode 26.0 (17A321) |
| **Шаги для воспроизведения** | 1. Иметь предыдущую версию приложения с несколькими настроенными серверами. <br> 2. Обновить приложение до новой сборки, включающей функцию "Управление пулом ключей". <br> 3. Запустить обновленное приложение. |
| **Факт. результат** | Список серверов пуст. Все пользовательские конфигурации серверов исчезли из UI. |
| **Ожид. результат** | Приложение должно без проблем переносить существующие пользовательские данные. Все ранее настроенные серверы должны присутствовать и корректно загружаться. |
| **Анализ причины** | В модель данных `ServerConfig` было добавлено новое обязательное поле типа boolean (`isKeyPoolingEnabled`). Реализация `Codable` не смогла декодировать старые данные из `UserDefaults`, поскольку в них отсутствовало это новое поле, что вызвало ошибку, которая приводила к обнулению списка серверов. |

---

### **Дефект: BUG-002 (Критический)**

| Поле | Значение |
| :--- | :--- |
| **Название** | **[CRITICAL]** Метрики не загружаются ни для одного сервера. Ошибка "Request Timed Out". |
| **Серьезность** | Critical |
| **Приоритет** | High |
| **Окружение** | PulseVPN Manager v1.3 (Сборка Z) на macOS Sequoia 15.6.1, Xcode 26.0 (17A321), любой IP-адрес сервера. |
| **Шаги для воспроизведения** | 1. Убедиться, что эндпоинт метрик на стороне сервера запущен на порту 8080. <br> 2. Запустить приложение и перейти на вкладку "Servers". |
| **Факт. результат** | Метрики не загружаются. В консоли повторяющаяся ошибка `NSURLErrorDomain Code=-1001 "The request timed out."` для каждого сервера. |
| **Ожид. результат** | Приложение должно успешно подключаться к эндпоинту метрик сервера на порту 8080 и получать данные. |
| **Анализ причины** | Сетевой файрвол на уровне хостинг-провайдера блокировал весь входящий TCP-трафик на порт `8080`. Хотя файрвол на уровне ОС (`ufw`) был настроен правильно, внешний файрвол отбрасывал пакеты подключения, что приводило к тайм-ауту на стороне клиента. |

---

### **Дефект: BUG-003 (Критический)**

| Поле | Значение |
| :--- | :--- |
| **Название** | **[CRITICAL]** Скрипт метрик генерирует невалидный JSON на серверах с не-американской локалью. |
| **Серьезность** | Critical |
| **Приоритет** | High |
| **Окружение** | Серверный скрипт `server_metrics.sh` v2.0 на ОС Debian с немецкой локалью. |
| **Шаги для воспроизведения** | 1. Подключиться по SSH к серверу с локалью, использующей запятую в качестве десятичного разделителя. <br> 2. Выполнить скрипт метрик напрямую: `/root/server_metrics.sh`. |
| **Факт. результат** | Скрипт выводит значения типа `"cpuUsage": 0,6`, что является невалидным JSON и вызывает сбой парсинга. |
| **Ожид. результат** | Скрипт всегда должен генерировать валидный JSON-документ с точками в качестве десятичных разделителей, независимо от системной локали. |
| **Анализ причины** | Скрипт не форсировал определенную локаль для форматирования чисел, что заставляло `awk` и `free` использовать системный разделитель по умолчанию. |

---

### **Дефект: BUG-004 (Критический)**

| Поле | Значение |
| :--- | :--- |
| **Название** | **[CRITICAL]** Скрипт метрик вызывает ошибки shell при конкатенации строк. |
| **Серьезность** | Critical |
| **Приоритет** | High |
| **Окружение** | Серверный скрипт `server_metrics.sh` v2.0 на ОС Debian. |
| **Шаги для воспроизведения** | 1. Подключиться по SSH к серверу. <br> 2. Выполнить скрипт метрик напрямую: `/root/server_metrics.sh`. |
| **Факт. результат** | Ошибка в конкатенации строк приводит к попытке shell выполнить число как команду. |
| **Ожид. результат** | Скрипт должен корректно обрабатывать строковые операции без ошибок shell. |
| **Анализ причины** | Ошибка в том, как конструировалась строковая переменная, что приводило к попытке shell выполнить число как команду. |

---

### **Дефект: BUG-005 (Низкий)**

| Поле | Значение |
| :--- | :--- |
| **Название** | **[UI]** Длинные заголовки метрик в представлении "Servers" переносятся на новую строку, нарушая верстку. |
| **Серьезность** | Low |
| **Приоритет** | Low |
| **Окружение** | PulseVPN Manager v1.3 на macOS Sequoia 15.6.1, Xcode 26.0 (17A321) |
| **Шаги для воспроизведения** | 1. Перейти на вкладку "Servers". <br> 2. Посмотреть на секцию "Live Metrics" для любого сервера. |
| **Факт. результат** | Заголовки "Connections" и "Containers" слишком длинные и переносятся на новую строку, создавая неровный и непрофессиональный вид. |
| **Ожид. результат** | Все заголовки должны находиться на одной строке. Длинные заголовки должны быть сокращены или обрезаны. |
| **Анализ причины** | У `Text` представлений для заголовков отсутствовал модификатор `.lineLimit(1)`, а сами заголовки не были достаточно лаконичными. |

---

# Отчеты о верификации: PulseVPN Manager v1.3

**Продукт:** PulseVPN Manager
**Версия:** 1.3 (Сборка 20250915)
**Автор:** Евгений Л
**Дата:** 15.09.2025

---

Этот документ содержит результаты повторного тестирования критических дефектов после применения исправлений командой разработки.

### **Верификация для BUG-001: Исчезновение серверов**

| Поле | Значение |
| :--- | :--- |
| **Связанный дефект** | `BUG-001` |
| **Проверенная сборка** | Y+1 |
| **Шаги теста** | 1. Установить сборку Y на чистое устройство. <br> 2. Добавить три сервера, затем закрыть приложение. <br> 3. Установить новую сборку (Y+1). <br> 4. Запустить приложение. |
| **Факт. результат** | Приложение запустилось успешно. Список из трех серверов присутствовал и был полностью загружен. Данные не были потеряны. |
| **Заключение** | **ПРОЙДЕНО**. Исправление (кастомный `Decodable` инициализатор в модели `ServerConfig`) корректно обрабатывает миграцию старых данных, предоставляя значение по умолчанию для отсутствующего поля. |

---

### **Верификация для BUG-002: Тайм-аут запроса**

| Поле | Значение |
| :--- | :--- |
| **Связанный дефект** | `BUG-002` |
| **Проверенная сборка** | Z+1 |
| **Шаги теста** | 1. В веб-панели хостинг-провайдера добавить новое входящее правило файрвола: **РАЗРЕШИТЬ TCP-трафик на порт 8080 со всех источников (0.0.0.0/0)**. <br> 2. Запустить приложение на клиентском устройстве. <br> 3. Перейти на вкладку "Servers". |
| **Факт. результат** | Приложение успешно подключилось к эндпоинту метрик сервера. "Живые" метрики начали загружаться и отображаться в интерфейсе. Ошибка `Request Timed Out` больше не появляется в логах. |
| **Заключение** | **ПРОЙДЕНО**. Основная причина была подтверждена — внешний сетевой файрвол. Открытие порта решило проблему. |

---

### **Верификация для BUG-003: Невалидный JSON из-за локали**

| Поле | Значение |
| :--- | :--- |
| **Связанный дефект** | `BUG-003` |
| **Проверенная сборка** | Серверный скрипт v3.0 |
| **Шаги теста** | 1. Подключиться по SSH к серверу с немецкой локалью. <br> 2. Развернуть новый скрипт `server_setup.sh` (v3.0). <br> 3. Выполнить `curl -s http://localhost:8080/metrics \| jq .` для тестирования эндпоинта. |
| **Факт. результат** | Сервер вернул синтаксически валидный JSON-объект. Все числовые значения использовали точку в качестве десятичного разделителя (например, `"cpuUsage": 2.1`). Команда `jq` обработала вывод без ошибок. |
| **Заключение** | **ПРОЙДЕНО**. Принудительная установка локали `LC_ALL=C` в скрипте успешно решила проблему с десятичным разделителем. |

---

### **Верификация для BUG-004: Ошибки shell в скрипте**

| Поле | Значение |
| :--- | :--- |
| **Связанный дефект** | `BUG-004` |
| **Проверенная сборка** | Серверный скрипт v3.0 |
| **Шаги теста** | 1. Подключиться по SSH к серверу. <br> 2. Развернуть новый скрипт `server_setup.sh` (v3.0). <br> 3. Выполнить скрипт метрик: `/root/server_metrics.sh`. |
| **Факт. результат** | Скрипт выполнился без ошибок shell. Строковые операции обрабатываются корректно. |
| **Заключение** | **ПРОЙДЕНО**. Исправления в конкатенации строк решили проблему с ошибками shell. |

---

### **Верификация для BUG-005: Перенос текста в UI**

| Поле | Значение |
| :--- | :--- |
| **Связанный дефект** | `BUG-005` |
| **Проверенная сборка** | Z+1 |
| **Шаги теста** | 1. Запустить приложение. <br> 2. Перейти на вкладку "Servers" и наблюдать за секцией "Live Metrics". |
| **Факт. результат** | Заголовки метрик были изменены с "Connections" на "Conns" и с "Containers" на "Docker". Все заголовки теперь аккуратно помещаются на одной строке. |
| **Заключение** | **ПРОЙДЕНО**. Комбинация сокращения заголовков и применения `.lineLimit(1)` решила проблему с версткой. |

---
